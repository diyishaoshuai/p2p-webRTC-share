{
  "permissions": {
    "allow": [
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"echo ''SSH连接成功'' && uname -a\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"node -v && npm -v && pnpm -v 2>/dev/null || echo ''pnpm未安装''\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"netstat -tuln | grep :8888 || echo ''端口8888未被占用''\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"ls -la /var/www/ 2>/dev/null || echo ''目录不存在''\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"mkdir -p /var/www/webrtc-share && echo ''目录创建成功''\")",
      "Bash(scp:*)",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"ls -la /var/www/webrtc-share/\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"cd /var/www/webrtc-share && pnpm install\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"cd /var/www/webrtc-share && pnpm config set registry https://registry.npmmirror.com\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"cd /var/www/webrtc-share && pnpm install --prod\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"cd /var/www/webrtc-share && rm -rf node_modules pnpm-lock.yaml && pnpm install --no-frozen-lockfile\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"npm install -g pnpm@9\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"pm2 -v 2>/dev/null || echo ''PM2未安装''\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"cd /var/www/webrtc-share && pm2 start ecosystem.config.js\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"pm2 logs webrtc-share --lines 10 --nostream\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"pm2 save\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"netstat -tuln | grep :8888\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"systemctl status firewalld 2>/dev/null || echo ''防火墙未运行''\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"nginx -v 2>&1 || echo ''Nginx未安装''\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"firewall-cmd --list-ports\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"firewall-cmd --permanent --add-port=8888/tcp && firewall-cmd --reload\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"ls -la /etc/nginx/conf.d/\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"nginx -t\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"cat /etc/nginx/conf.d/qqchatbot.conf\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"rm /etc/nginx/conf.d/webrtc-share.conf\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"cp /etc/nginx/conf.d/qqchatbot.conf /etc/nginx/conf.d/qqchatbot.conf.bak\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"sed -i ''/# 管理后台 - \\\\/bot 路径/i\\\\    # WebRTC屏幕共享服务\\\\n    location /webrtc {\\\\n        proxy_pass http://127.0.0.1:8888;\\\\n        proxy_http_version 1.1;\\\\n        proxy_set_header Upgrade $http_upgrade;\\\\n        proxy_set_header Connection \"\"upgrade\"\";\\\\n        proxy_set_header Host $host;\\\\n        proxy_set_header X-Real-IP $remote_addr;\\\\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\\\\n        proxy_set_header X-Forwarded-Proto $scheme;\\\\n        proxy_connect_timeout 60s;\\\\n        proxy_send_timeout 60s;\\\\n        proxy_read_timeout 60s;\\\\n    }\\\\n'' /etc/nginx/conf.d/qqchatbot.conf\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"cp /etc/nginx/conf.d/qqchatbot.conf.bak /etc/nginx/conf.d/qqchatbot.conf\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"systemctl reload nginx\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"curl -I http://localhost:8888\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"certbot --nginx -d webrtcshare.filingservice.cn --non-interactive --agree-tos --email admin@filingservice.cn\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"curl -I https://webrtcshare.filingservice.cn\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"yum install -y coturn\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"openssl rand -hex 32\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"cat > /etc/coturn/turnserver.conf << ''EOF''\n# TURN服务器监听端口\nlistening-port=3478\ntls-listening-port=5349\n\n# 外部IP地址\nexternal-ip=120.26.41.79\n\n# 中继IP范围\nrelay-ip=120.26.41.79\n\n# 用户认证\nuser=webrtc:afdd233930fb274a47ee7aab07d19776a570815fbddcb2b8d749e50810e4ae9c\n\n# 域名\nrealm=webrtcshare.filingservice.cn\n\n# 日志\nlog-file=/var/log/turnserver.log\nverbose\n\n# 性能优化\nfingerprint\nlt-cred-mech\n\n# 禁止使用的IP范围（安全）\nno-loopback-peers\nno-multicast-peers\n\n# 允许的端口范围\nmin-port=49152\nmax-port=65535\nEOF\necho ''配置文件已创建''\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"firewall-cmd --permanent --add-port=3478/tcp && firewall-cmd --permanent --add-port=3478/udp && firewall-cmd --permanent --add-port=5349/tcp && firewall-cmd --permanent --add-port=49152-65535/udp && firewall-cmd --reload\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"systemctl enable coturn && systemctl start coturn && systemctl status coturn\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"systemctl status coturn | head -20\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"cat > /etc/coturn/turnserver.conf << ''EOF''\n# TURN服务器监听端口\nlistening-port=3478\ntls-listening-port=5349\n\n# 监听所有网络接口\nlistening-ip=0.0.0.0\n\n# 外部IP地址（用于NAT穿透）\nexternal-ip=120.26.41.79\n\n# 用户认证\nuser=webrtc:afdd233930fb274a47ee7aab07d19776a570815fbddcb2b8d749e50810e4ae9c\n\n# 域名\nrealm=webrtcshare.filingservice.cn\n\n# 日志\nsyslog\n\n# 性能优化\nfingerprint\nlt-cred-mech\n\n# 禁止使用的IP范围（安全）\nno-loopback-peers\nno-multicast-peers\n\n# 允许的端口范围\nmin-port=49152\nmax-port=65535\nEOF\necho ''配置文件已更新''\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"systemctl restart coturn && sleep 2 && systemctl status coturn\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"netstat -tuln | grep 3478\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"cat /etc/coturn/turnserver.conf\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"cat > /etc/coturn/turnserver.conf << ''EOF''\n# TURN服务器监听端口\nlistening-port=3478\ntls-listening-port=5349\n\n# 监听所有网络接口\nlistening-ip=0.0.0.0\n\n# 外部IP地址（用于NAT穿透）\nexternal-ip=120.26.41.79\n\n# 用户认证 - 使用时间限制的动态凭证\nuse-auth-secret\nstatic-auth-secret=afdd233930fb274a47ee7aab07d19776a570815fbddcb2b8d749e50810e4ae9c\n\n# 域名\nrealm=webrtcshare.filingservice.cn\n\n# 日志\nsyslog\n\n# 性能优化\nfingerprint\nlt-cred-mech\n\n# 禁止使用的IP范围（安全）\nno-loopback-peers\nno-multicast-peers\n\n# 允许的端口范围\nmin-port=49152\nmax-port=65535\n\n# 资源限制（针对2h2g服务器）\nmax-bps=5000000\nbps-capacity=5000000\ntotal-quota=100\nuser-quota=5\nmax-allocate-lifetime=7200\nstale-nonce=600\n\n# 连接限制\nno-tcp-relay\nno-tls\nno-dtls\nEOF\necho ''配置文件已更新''\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"systemctl restart coturn && sleep 2 && systemctl status coturn | head -20\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"cd /var/www/webrtc-share && pm2 restart webrtc-share\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"pm2 logs webrtc-share --lines 20 --nostream\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"head -50 /var/www/webrtc-share/server.js\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"pm2 logs webrtc-share --lines 30 --nostream\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"grep -n ''checkMemoryUsage'' /var/www/webrtc-share/server.js | head -20\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"sed -n ''91,103p'' /var/www/webrtc-share/server.js\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"pm2 flush webrtc-share\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"timeout 10 pm2 logs webrtc-share --lines 0 || true\")",
      "Bash(ssh -i \"$env:USERPROFILE\\\\.ssh\\\\id_rsa\" -o StrictHostKeyChecking=no root@120.26.41.79 \"head -30 /var/www/webrtc-share/public/client.js\")",
      "Bash(git init:*)",
      "Bash(git config:*)",
      "Bash(git add:*)"
    ]
  }
}
